<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - ExoList</title>
<link rel="stylesheet" href="css/main.css">
<style>
  body {
    font-family: "Montserrat", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }
  h1 {
    margin-bottom: 20px;
  }
  table {
    border-collapse: collapse;
    width: 90%;
    max-width: 1000px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }
  th {
    background-color: #f2f2f2;
  }
  img.thumbnail {
    width: 100px;
    height: auto;
  }
  button {
    padding: 8px 15px;
    margin: 5px;
    cursor: pointer;
  }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCj6LTxzxI1EUaQ-qTnZjZSkqMDvhRjEy8",
  authDomain: "exolist-b5c02.firebaseapp.com",
  projectId: "exolist-b5c02",
  storageBucket: "exolist-b5c02.firebasestorage.app",
  messagingSenderId: "597550596889",
  appId: "1:597550596889:web:470c4488f9161b68007b88",
  measurementId: "G-79CTWHYEGF"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Check login and admin role
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    alert("Please log in first.");
    window.location.href = "login.html";
    return;
  }

  const userDoc = await getDoc(doc(db, "users", user.uid));
  if (!userDoc.exists() || !userDoc.data().isAdmin) {
    alert("Access denied! Admins only.");
    window.location.href = "index.html";
    return;
  }

  document.getElementById("adminEmail").textContent = user.email;
  await loadSubmissions();
});

// Load level submissions
async function loadSubmissions() {
  const tableBody = document.getElementById("submissions-body");
  const snapshot = await getDocs(collection(db, "levelSubmissions"));
  tableBody.innerHTML = "";
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${data.playerName}</td>
      <td>${data.levelName}</td>
      <td><img src="${data.thumbnail}" alt="Thumbnail" class="thumbnail"></td>
      <td>${data.firstVictor}</td>
      <td>${new Date(data.date).toLocaleString()}</td>
      <td><button onclick="removeSubmission('${docSnap.id}')">Remove</button></td>
    `;
    tableBody.appendChild(row);
  });
}

// Remove a submission
async function removeSubmission(id) {
  if (confirm("Are you sure you want to remove this submission?")) {
    await deleteDoc(doc(db, "levelSubmissions", id));
    loadSubmissions();
  }
}

// Logout
function logout() {
  signOut(auth);
  window.location.href = "login.html";
}
</script>
</head>
<body>
<h1>Admin Dashboard</h1>
<p>Logged in as: <span id="adminEmail"></span></p>
<table>
  <thead>
    <tr>
      <th>Player</th>
      <th>Level</th>
      <th>Thumbnail</th>
      <th>First Victor</th>
      <th>Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="submissions-body"></tbody>
</table>
<button onclick="logout()">Logout</button>
</body>
</html>
